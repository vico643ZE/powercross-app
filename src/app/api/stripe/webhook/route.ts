import Stripe from 'stripe'\n\nexport async function POST(req: Request) {\n  const sig = req.headers.get('stripe-signature')\n  const whSecret = process.env.STRIPE_WEBHOOK_SECRET\n  if (!sig || !whSecret) return new Response('Webhook not configured', { status: 400 })\n\n  const buf = Buffer.from(await req.arrayBuffer())\n  const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, { apiVersion: '2024-06-20' })\n\n  let event: Stripe.Event\n  try {\n    event = stripe.webhooks.constructEvent(buf, sig, whSecret)\n  } catch (err: any) {\n    return new Response(`Webhook Error: ${err.message}`, { status: 400 })\n  }\n\n  // TODO: handle events (invoice.paid, customer.subscription.created, etc.)\n\n  return new Response('ok', { status: 200 })\n}\n